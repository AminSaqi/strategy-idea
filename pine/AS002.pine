// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© QuantCT

//@version=4

strategy(title="AS002 Idea", 
         shorttitle="AS002", 
         overlay=true,
         pyramiding=0,     
         default_qty_type=strategy.fixed, 
         default_qty_value=1.0, 
         initial_capital=100000,           
         commission_type=strategy.commission.percent, 
         commission_value=0.0)

high_period = input(title="Highest High Period", defval=5)
low_period = input(title="Lowest Low Period", defval=7)

start_date = timestamp(syminfo.timezone, 2018, 1, 7, 0, 0)
end_date = timestamp(syminfo.timezone, 2020, 12, 30, 23, 59)
in_date_range = time >= start_date and time <= end_date

if (in_date_range)    
    highest_high = highest(high, high_period)
    lowest_low = lowest(low, low_period)
    [macd_line, signal_line, macd_hist] = macd(close, 12, 26, 9)

    buy_condition = macd_hist > 0 and close > highest_high[1]
    sell_condition = macd_hist < 0 or close < lowest_low[1]

    strategy.entry("Buy", strategy.long, when=buy_condition)
    strategy.close("Buy", when=sell_condition)   
